<canvas id="canvas" style="boarder:1px solid #000000" cursor="none">
	Your browser does not support canvas element
</canvas>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.js"></script>
<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
<script src="client/gameWindow.js"></script>
<script src="client/point.js"></script>
<script src="client/game.js"></script>
<script>
	console.log('index.html: init')

	document.body.style.backgroundColor = 'black'
	mouse.prev = pt.copy(mouse)
	mouse.prev.isDown = false

	var level = new mg.Level()
	socket.on('handShake', function(cs) {
		for (var i in cs) {
			var c = cs[i]
		}
		tick()
	})

	function tick() {
		update()

		g.lineWidth = 1
		g.strokeStyle = 'white'
		g.fillStyle = 'white'
		g.font = '10px Arial'
		g.textAlign = 'center'

		level.draw(g)

		var nmodes = mg.modeKeys.length
		g.fillStyle = 'black'
		g.beginPath()
		g.rect(5, 5, 2 * mg.cellSize, 2 * nmodes * mg.cellSize)
		g.fill()

		g.strokeStyle = 'white'
		g.beginPath()
		g.rect(5, 5, 2 * mg.cellSize, 2 * nmodes * mg.cellSize)
		g.stroke()

		for (var i in mg.modeKeys) {
			var k = mg.modeKeys[i]
			var m = mg.modes[k]
			m.draw(g, i)
			if (k == mg.mode) {
				g.beginPath()
				g.rect(5 + mg.cellSize / 2, 5 + mg.cellSize * (1 / 2 + 2 * i), mg.cellSize, mg.cellSize)
				g.stroke()
			}
		}

		if (2 * mg.cellSize >= mouse.x && mouse.x >= 5 && 2 * nmodes * mg.cellSize > mouse.y && mouse.y >= 5) {
			var i = Math.floor((mouse.y - 5) / (2 * mg.cellSize))
			g.strokeStyle = 'white'
			g.beginPath()
			g.rect(5 + mg.cellSize / 2, 5 + mg.cellSize * (1 / 2 + 2 * i), mg.cellSize, mg.cellSize)
			g.stroke()

			if (mouse.ups || mouse.isDown) {
				mg.mode = mg.modeKeys[i]
				console.log('mode set to ' + mg.mode)
			}
		} else {
			level.action(mg.mode, mouse, 'mouse')

			var m = pt.sum(mg.shift, pt.scale(mg.Cell.get(mouse), mg.cellSize))
			g.strokeStyle = 'white'
			var d = (mg.cellSize - mg.cellWidth) / 2
			g.beginPath()
			g.rect(m.x - d, m.y - d, mg.cellSize, mg.cellSize)
			g.stroke()
		}

		g.textAlign = 'left'
		g.fillStyle = 'white'
		g.fillText(`fps:${Math.floor(1e3/dt)}`, 5, 5 + 2 * nmodes * mg.cellSize + 10)

		g.fillStyle = 'white'
		pt.fillCircle(g, mouse)

		mouse.prev = pt.copy(mouse)
		mouse.prev.isDown = mouse.isDown
		reqFrame(tick)
	}
</script>
